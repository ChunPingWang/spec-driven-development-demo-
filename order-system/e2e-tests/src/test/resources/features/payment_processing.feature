# language: zh-TW
@payment
功能: 支付處理流程
  作為一個支付系統
  我希望能安全地處理各種支付情境
  以便確保交易的完整性

  @positive
  場景: 成功授權並請款
    假設 有效的支付請求金額為 35900 元幣別為 "TWD"
    並且 信用卡號為 "4111111111111111" 有效期為 "12/26" CVV 為 "123"
    當 執行支付授權
    那麼 授權應成功
    並且 應返回支付編號
    當 執行請款
    那麼 請款應成功
    並且 支付狀態應為 "CAPTURED"

  @positive
  場景: 成功取消授權
    假設 有效的支付請求金額為 50000 元幣別為 "TWD"
    並且 信用卡號為 "4111111111111111" 有效期為 "12/26" CVV 為 "123"
    當 執行支付授權
    那麼 授權應成功
    當 取消支付授權
    那麼 取消應成功
    並且 支付狀態應為 "VOIDED"

  @negative
  場景: 餘額不足時授權失敗
    假設 有效的支付請求金額為 1000000 元幣別為 "TWD"
    並且 信用卡號為 "4000000000000002" 有效期為 "12/26" CVV 為 "123"
    當 執行支付授權
    那麼 授權應失敗
    並且 失敗原因應為 "Insufficient funds"

  @negative
  場景: 卡片過期時授權失敗
    假設 有效的支付請求金額為 35900 元幣別為 "TWD"
    並且 信用卡號為 "4111111111111111" 有效期為 "01/20" CVV 為 "123"
    當 執行支付授權
    那麼 授權應失敗
    並且 失敗原因應為 "Card expired"

  @negative
  場景: CVV 錯誤時授權失敗
    假設 有效的支付請求金額為 35900 元幣別為 "TWD"
    並且 信用卡號為 "4111111111111111" 有效期為 "12/26" CVV 為 "999"
    當 執行支付授權
    那麼 授權應失敗
    並且 失敗原因應為 "Invalid CVV"

  @negative
  場景: 重複請款應失敗
    假設 有效的支付請求金額為 35900 元幣別為 "TWD"
    並且 信用卡號為 "4111111111111111" 有效期為 "12/26" CVV 為 "123"
    當 執行支付授權
    並且 執行請款
    當 再次執行請款
    那麼 請款應失敗
    並且 失敗原因應為 "Payment already captured"
